"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);e=i.call(t,e||"default");if("object"!==_typeof(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}!function(){function h(t){for(;t.match(/^\.+\//)||t.startsWith("/");)t=t.substring(t.indexOf("/")+1);return t}var e=function(){function e(t){var i=this;_classCallCheck(this,e),this.root=t,this.slider=t.querySelector(".slideshow"),this.accessibility=t.querySelector(".accessibility"),this.overlay=this.slider.querySelector(".overlay"),this.overlayTitle=this.overlay.querySelector("h2"),this.accessibility.style.opacity="0.01",this.images=[],this.curX=0,this.targetX=0,this.open=!0,this.bgTop=this.createBackgroundElement("top"),this.bgBottom=this.createBackgroundElement("bottom"),this.displayItems=[this.createItemElement(),this.createItemElement(),this.createItemElement()],this.listenerAbort=new AbortController,this.loadDefaults(),this.enterRenderLoop(),this.autoScrollInterval=-1,this.resetAutoScroll(),window.addEventListener("keydown",function(t){"ArrowLeft"===t.key||"ArrowLeft"===t.code||37===t.which||37===t.keyCode?i.manualScroll(-1):"ArrowRight"!==t.key&&"ArrowRight"!==t.code&&39!==t.which&&39!==t.keyCode||i.manualScroll(1)},{signal:this.listenerAbort.signal}),window.addEventListener("wheel",function(t){0<t.deltaX||0<t.deltaY?i.manualScroll(1):(t.deltaX<0||t.deltaY<0)&&i.manualScroll(-1)},{signal:this.listenerAbort.signal}),this.slider.addEventListener("click",function(t){var e=i.normalizeXPosition(Math.round(i.curX)),e=i.images[e];e.link&&(window.location.hash=e.link)},{signal:this.listenerAbort.signal});for(var r=[[this.overlay.querySelector('[data-role="left-arrow"]'),-1],[this.overlay.querySelector('[data-role="right-arrow"]'),1]],o=0;o<r.length;o++)!function(){var t=r[o],e=t[1];t[0]&&t[0].addEventListener("click",function(t){i.targetX=i.targetX+e,i.resetAutoScroll(),t.preventDefault(),t.stopPropagation()},{signal:i.listenerAbort.signal})}()}return _createClass(e,[{key:"manualScroll",value:function(t){var e=Date.now();(e-(this.lastManualScroll||0))/1e3<.125||(this.lastManualScroll=e,this.targetX=this.targetX+t,this.resetAutoScroll())}},{key:"resetAutoScroll",value:function(){var t=this;this.open&&(clearInterval(this.autoScrollInterval),this.autoScrollInterval=setInterval(function(){document.hasFocus&&!document.hasFocus()||document.visibilityState&&"visible"!==document.visibilityState||(t.targetX=t.targetX+1)},6e3))}},{key:"loadDefaults",value:function(){var t,e=document.querySelector("script#gallery-data");try{t=JSON.parse(e.innerHTML)}catch(t){return void console.warn(t)}if(Array.isArray(t))for(var i=0;i<t.length;i++){var r=t[i];"string"==typeof r.link&&(r.link="#"+h(r.link)),"string"==typeof r.image&&(r.image="./assets/"+h(r.image));var o=new Image;o.src=r.image,r.imageElement=o,this.images.push(r)}for(var n=0;n<this.images.length;n++){var a,s=this.images[n],l=document.createElement("article"),c=document.createElement("h2");c.innerText=s.title,l.appendChild(c),"string"==typeof s.description&&((a=document.createElement("p")).innerText=s.description,l.appendChild(a)),"string"==typeof s.link&&((a=document.createElement("a")).innerText="Link",a.href=s.link,l.appendChild(a)),this.accessibility.appendChild(l)}}},{key:"createBackgroundElement",value:function(t){var e=document.createElement("img");return e.classList.add("bg"),e.classList.add(t),this.slider.appendChild(e),e}},{key:"createItemElement",value:function(){var t=document.createElement("img");return t.classList.add("item"),this.slider.appendChild(t),t}},{key:"scrollHorizontal",value:function(){if(!window.getComputedStyle)return!1;var t=window.getComputedStyle(document.documentElement);return!!t&&(!!t.getPropertyValue&&"horizontal"===(t.getPropertyValue("--slideshow-scroll-dir")+"").toLowerCase())}},{key:"close",value:function(){this.listenerAbort.abort(),clearInterval(this.autoScrollInterval),this.open=!1}},{key:"normalizeXPosition",value:function(t){for(t%=this.images.length;t<0;)t+=this.images.length;return t}},{key:"enterRenderLoop",value:function(){var t=this;this.open&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){t.renderLoop()}):setTimeout(function(){t.renderLoop()},10))}},{key:"renderLoop",value:function(){var t=Date.now(),e=(t-(this.lastRenderTime||t))/1e3;this.lastRenderTime=t;var i=this.targetX-Math.round(this.targetX);this.targetX=this.targetX-i*e;var r,o=4*e;this.curX=this.curX*(1-o)+this.targetX*o,0<this.images.length&&(t=((r=this.normalizeXPosition(Math.floor(this.curX)))+1)%this.images.length,i=Math.max(this.curX-Math.floor(this.curX),0),e=this.images[r],o=this.images[t],this.bgBottom.style.opacity=1,this.bgBottom.src=e.image,this.bgBottom.alt=e.title,this.bgBottom.title=e.title,this.bgTop.style.opacity=i,this.bgTop.src=o.image,this.bgTop.alt=o.title,this.bgTop.title=o.title,r=Math.round(this.curX),t=this.slider.getBoundingClientRect(),e=-(this.curX-r),i=this.normalizeXPosition(r),o=this.normalizeXPosition(i-1),r=this.normalizeXPosition(i+1),this.positionFrame(e-1,this.displayItems[0],t.width,t.height,this.images[o]),this.positionFrame(e,this.displayItems[1],t.width,t.height,this.images[i]),this.positionFrame(1+e,this.displayItems[2],t.width,t.height,this.images[r]),Math.abs(e)<.5&&(this.overlayTitle.innerText=this.images[i].title,this.slider.setAttribute("title",this.images[i].description||"")),this.overlayTitle.style.opacity=(1-Math.pow(Math.abs(e)/.5,2)).toString()),this.enterRenderLoop()}},{key:"positionFrame",value:function(t,e,i,r,o){var n=o.imageElement.naturalWidth/o.imageElement.naturalHeight,a=r*n,s=r;i<a&&(s=(a=i)/n);n=.8*Math.pow(Math.max(1-Math.abs(t/2),0),2);a*=n,s*=n,e.src!==o.image&&(e.src=o.image),e.style.width="".concat(a,"px"),e.style.height="".concat(s,"px");a=(i-a)/2,s=(r-s)/2;this.scrollHorizontal()?a+=t*i:s+=t*r,e.style.left="".concat(a,"px"),e.style.top="".concat(s,"px")}}]),e}(),i=-1;window.addEventListener("moduleLoad",function(t){"home"===t.detail.page&&(i=new e(document.querySelector("#gallery-container")))}),window.addEventListener("moduleUnload",function(t){"home"===t.detail.page&&(-1!==i&&i.close(),i=-1)})}();